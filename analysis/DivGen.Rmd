---
title: "Diversidade Genetica"
author: "LucianoRogerio"
date: "2021-11-08"
output: workflowr::wflow_html
editor_options:
  chunk_output_type: console
---

## Introduction

```{r}
library(tidyverse); library(reactable)
source(here::here("code", "Shannon-Weaver.R"))
Alldataset <- readRDS(here::here("output", "AllDataCCCaroline.RDS"))

QualityTrait <- colnames(Alldataset)[2:36]


AlldataSetQuant <- Alldataset %>% select(-QualityTrait)
AlldataSetQuali <- Alldataset %>% select(Acessos, QualityTrait, Data, Method)

QuantTrait <- colnames(AlldataSetQuant)[2:17]
DataMethod <- unique(data.frame(Data = AlldataSetQuant$Data,
                                Method = AlldataSetQuant$Method))

QuantSHs <- NULL
for(i in 1:nrow(DataMethod)){
  for(trait in QuantTrait){
    QuantSH <- data.frame(Data = DataMethod$Data[i],
                          Method = DataMethod$Method[i],
                          Trait = trait,
                          SH = Shannon.Weaver.QT(AlldataSetQuant[(AlldataSetQuant$Data%in%DataMethod$Data[i] &
                                                                    AlldataSetQuant$Method%in%DataMethod$Method[i]),trait],
                                                 formula = 2))
    QuantSHs <- rbind(QuantSHs, QuantSH)
  }
}

Table1SH <- matrix(QuantSHs$SH, byrow = F, ncol = 13)
rownames(Table1SH) <- unique(QuantSHs$Trait)
colnames(Table1SH) <- unique(paste(QuantSHs$Data, QuantSHs$Method, sep = " - "))
colnames(Table1SH)[1] <- "BAG"

## Table 1 - Shannon-Weaver indexes for Cassava quantitative traits of the Bank of germplasm and 12 nuclear core collections.
Table1SH %>% reactable(defaultPageSize = 16, columns = list(
  BAG = colDef(format = colFormat(digits = 3, locales = "en-US")),
  'Pheno - GW/CH' = colDef(format = colFormat(digits = 3, locales = "en-US")),
  'Pheno - CH' = colDef(format = colFormat(digits = 3, locales = "en-US")),
  'Pheno - GW/MLST' = colDef(format = colFormat(digits = 3, locales = "en-US")),
  'Geno - MR/SH' = colDef(format = colFormat(digits = 3, locales = "en-US")),
  'Geno - CE/SH' = colDef(format = colFormat(digits = 3, locales = "en-US")),
  'Geno - MR/EH' = colDef(format = colFormat(digits = 3, locales = "en-US")),
  'Geno - CE/EH' = colDef(format = colFormat(digits = 3, locales = "en-US")),
  'Geno - MR/AC' = colDef(format = colFormat(digits = 3, locales = "en-US")),
  'Geno - CE/AC' = colDef(format = colFormat(digits = 3, locales = "en-US")),
  'Geno - AM/MLST' = colDef(format = colFormat(digits = 3, locales = "en-US")),
  'Geno - MR/MLST' = colDef(format = colFormat(digits = 3, locales = "en-US")),
  'Geno - CE/MLST' = colDef(format = colFormat(digits = 3, locales = "en-US"))))

Trait <- c("CorFolhaApical" = 4, "CorPeciolo" = 6, "CorFolhaDesenv" = 5,
           "CorNerv" = 4, "CorCortexCaule" = 4, "CorExternaCaule" = 7,
           "CorEpidCaule" = 4, "CorRamosTerm" = 3, "CorExternaRzs" = 4,
           "CorCortexRzs" = 4, "CorPolpaRzs" = 5, "NLobulos" = 5,
           "Pubescencia" = 2, "FormaLobuloCentral" = 9, "PosicaoPeciolo" = 4,
           "Sinuosidade" = 2, "ComprEstip" = 2, "HabCresCaule" = 2,
           "TipoPlan" = 4, "MargEstip" = 2, "HabRamif" = 4, "NiveisRam" = 4, 
           "ProemCicatrizesFolhas" = 2, "FormaRzs" = 4, "TxtEpidermeRzs" = 2,
           "PresPedunculoRzs" = 3, "PosicaoRzs" = 3, "Flowering" = 2,
           "DestqPelicRz" = 2, "DestqCortexRz" = 3, "ConstrRzs" = 3,
           "ComprFilotaxia" = 3, "AnguloRamif" = 22, "PorteMod" = 5, 
           "HCNMod" = 9)

QualTrait <- data.frame(Trait = names(Trait),
                        NClas = Trait,
                        row.names = NULL)

QualSHs <- NULL
for(i in 1:nrow(DataMethod)){
  for(trait in QualTrait$Trait) {
    QualSH <- data.frame(Data = DataMethod$Data[i],
                         Method = DataMethod$Method[i],
                         Trait = trait,
                         SH = Shannon.Weaver.QL(as.character(AlldataSetQuali[(AlldataSetQuali$Data%in%DataMethod$Data[i] &
                                                                    AlldataSetQuali$Method%in%DataMethod$Method[i]),trait]),
                                                nclass = QualTrait$NClas[QualTrait$Trait%in%trait]))
    QualSHs <- rbind(QualSHs, QualSH)
  }
}

Table2SH <- matrix(QualSHs$SH, byrow = F, ncol = 13)
rownames(Table2SH) <- unique(QualSHs$Trait)
colnames(Table2SH) <- unique(paste(QualSHs$Data, QualSHs$Method, sep = " - "))
colnames(Table2SH)[1] <- "BAG"

## Table 2 - Shannon-Weaver indexes for Cassava quality traits of the Bank of germplasm and 12 nuclear core collections.
Table2SH %>% reactable(defaultPageSize = 15, columns = list(
  BAG = colDef(format = colFormat(digits = 3, locales = "en-US")),
  'Pheno - GW/CH' = colDef(format = colFormat(digits = 3, locales = "en-US")),
  'Pheno - CH' = colDef(format = colFormat(digits = 3, locales = "en-US")),
  'Pheno - GW/MLST' = colDef(format = colFormat(digits = 3, locales = "en-US")),
  'Geno - MR/SH' = colDef(format = colFormat(digits = 3, locales = "en-US")),
  'Geno - CE/SH' = colDef(format = colFormat(digits = 3, locales = "en-US")),
  'Geno - MR/EH' = colDef(format = colFormat(digits = 3, locales = "en-US")),
  'Geno - CE/EH' = colDef(format = colFormat(digits = 3, locales = "en-US")),
  'Geno - MR/AC' = colDef(format = colFormat(digits = 3, locales = "en-US")),
  'Geno - CE/AC' = colDef(format = colFormat(digits = 3, locales = "en-US")),
  'Geno - AM/MLST' = colDef(format = colFormat(digits = 3, locales = "en-US")),
  'Geno - MR/MLST' = colDef(format = colFormat(digits = 3, locales = "en-US")),
  'Geno - CE/MLST' = colDef(format = colFormat(digits = 3, locales = "en-US"))))

SHs <- rbind(QuantSHs, QualSHs) %>% arrange(Data, Method)

write.table(SHs, here::here("output", "Shannon-WeaverCCIndex.csv"), dec = ".",
            sep = ",", quote = F, row.names = F)


```

