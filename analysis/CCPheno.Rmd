---
title: "Coleções Nucleares Fenotípicas"
author: "LucianoRogerio; Caroline Cardoso"
date: "2021-10-25"
output: workflowr::wflow_html
editor_options:
  chunk_output_type: console
---

## Coleções Nucleares Fenotípicas

```{r lendo dados fenotipicos, eval = FALSE}
DataCar <- readRDS(file = here::here("output", "DataSelPreparedCar.rds"))
DataCar <- DataCar %>% mutate(CorFolhaApical = as.character(CorFolhaApical),
                              CorPeciolo = as.character(CorPeciolo),
                              CorFolhaDesenv = as.character(CorFolhaDesenv),
                              CorNerv = as.character(CorNerv),
                              CorCortexCaule = as.character(CorCortexCaule),
                              CorExternaCaule = as.character(CorExternaCaule),
                              CorEpidCaule = as.character(CorEpidCaule),
                              CorRamosTerm = as.character(CorRamosTerm),
                              CorExternaRzs = as.character(CorExternaRzs),
                              CorCortexRzs = as.character(CorCortexRzs),
                              CorPolpaRzs = as.character(CorPolpaRzs),
                              Pubescencia = as.character(Pubescencia),
                              FormaLobuloCentral = as.character(FormaLobuloCentral),
                              PosicaoPeciolo = as.character(PosicaoPeciolo),
                              Sinuosidade = as.character(Sinuosidade),
                              HabCrescCaule = as.character(HabCrescCaule),
                              TipoPlan = as.character(TipoPlan),
                              MargEstip = as.character(MargEstip),
                              HabRamif = as.character(HabRamif),
                              NiveisRam = as.character(NiveisRam),
                              ProemCicatrizesFolhas = as.character(ProemCicatrizesFolhas),
                              FormaRzs = as.character(FormaRzs),
                              TxtEpidermeRzs = as.character(TxtEpidermeRzs),
                              PresPedunculoRzs = as.character(PresPedunculoRzs),
                              PosicaoRzs = as.character(PosicaoRzs),
                              Flowering = as.character(Flowering),
                              DestqPelicRz = as.character(DestqPelicRz),
                              DestqCortexRz = as.character(DestqCortexRz),
                              ConstrRzs = as.character(ConstrRzs))
```

### Coleção Nuclear 1 - Distância de Gower e pacote CoreHunter

```{r Estimacacao da Primeira colecao nuclear fen, eval = FALSE}
library(corehunter); library(StatMatch)
DistCar <- gower.dist(data.x = DataCar[,-1],)
row.names(DistCar) <- colnames(DistCar) <- DataCar$Acessos
DistCar2 <- distances(DistCar)

CCSize <- round(nrow(DistCar) * 0.2, digits = 0)

CCC <- sampleCore(DistCar2, objective(type = "EN", measure = "PD"), size = CCSize)

DataCarCCPheno1 <- DataCar[DataCar$Acessos%in%CCC$sel,]

write.table(DataCarCCPheno1, here::here("output", "CCPhenData", "DadosCCPheno1.CSV"),
            quote = F, sep = ";", dec = ".")
```

### Coleção Nuclear 2 - Algoritmo pacote CoreHunter

```{r Estimacacao da Segunda colecao nuclear fen, eval = FALSE}
DataCarP <- phenotypes(data = as.data.frame(DataCar[,-1]))
core <- sampleCore(DataCarP, objective(type = "EN", measure = "GD"), size = CCSize)

DataCarCCPheno2 <- DataCar[rownames(DataCar)%in%core$sel,]

write.table(DataCarCCPheno2, file = here::here("output", "CCPhenData", "DadosCCPheno2.CSV"),
            quote = F, sep = ";", dec = ".")
```

### Coleção Nuclear - Distância de Gower e Algoritmo MLST DARwin

```{r Preparando a matriz de distancias de Gower para DARwin, eval = FALSE}
library(phangorn)
DistCar <- as.dist(DistCar)
writeDist(x = DistCar, file = here::here("output", "MatrizGowerCaroline.phy"),
          upper = F, diag = F)

CCSize
```

Obs.: o arquivo tipo phyllip criado pela função `writeDist` está com separação por espaço e deve ser trocado para tabulação para que o software DARwin possa aceitá-lo.



```{r Obtendo os resultados de DARwin e separando os resultados}
SelDARwin <- read.table(here::here("output","MatrizGowerCaroline.DON"),
                             sep = "\t", header = T, skip = 2,
                             nrows = 1686)
ClonesSel <- SelDARwin %>% filter(CC338 == "Kept") %>%
  select(Name)
DataCarCCPheno3 <- DataCar[DataCar$Acessos%in%ClonesSel$Name,]

write.table(DataCarCCPheno3, file= here::here("output", "CCPhenData", "DadosCCPheno3.CSV"),
            quote = F, sep = ";", dec = ".")
```

Back - [Dados Moleculares - Seleção](GenoData.html)

Next - [Coleções Nucleares Genotípicas](CNGeno.html)

[Home](index.html)
